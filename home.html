<html class="ui-mobile">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Multi-page template</title>
    <link rel="stylesheet" href="./themes/forgather.css" />
    <link rel="stylesheet" href="./themes/style.css" />
    <link rel="stylesheet" href="./themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="./themes/jquery.mobile.structure-1.4.2.min.css" />
    <script src="./scripts/jquery-1.10.2.min.js"></script>
    <script src="./scripts/jquery.mobile-1.4.2.min.js"></script>
</head>


<body class="ui-mobile-viewport ui-overlay-b">
    <div data-role="popup" id="menu" data-theme="c" style="top:30px;">
        <ul data-role="listview" data-inset="false" style="min-width:210px;">
            <li data-icon="false"><a href="http://student.howest.be/nicola.nauwynck/">Website</a></li>
            <li data-icon="false"><a href="#" onclick="logout()">Logout</a></li>
        </ul>
    </div>

    <div data-role="popup" id="share" data-theme="c" style="top:30px;">
        <ul data-role="listview" data-inset="false" style="min-width:210px;">
            <li data-icon="false"><a href="#invite_friend">Forgather account</a></li>
            <li data-icon="false"><a href="#generate_QR">QR-code</a></li>
        </ul>
    </div>


    <div data-role="page" id="show_user" data-theme="b">
        <div data-role="header" class="header">
            <div class="left"><a href="#share" data-rel="popup" data-transition="fade" data-position-to="origin"><img src="images/share.png" /></a><a data-transition="none" onclick="scan()"><img src="images/scan.png" /></a></div>
            <div class="right"><a href="#show_user_panel" data-transition="none"><img src="images/friends.png" class="friends" /></a><a href="#menu" data-rel="popup" data-transition="fade" data-position-to="origin"><img src="images/menu.png" /></a></div>
            <div class="center"><a href="#show_user" data-transition="none"><img src="images/logo.png" class="logo" /></a></div>
        </div>

        <div data-role="content" class="ui-content home" role="main">
            <div class="section">
                <div class="profile">
                    <div class="right"><a href="#edit_user" data-transition="none"><img src="images/edit.png" style="height:30px; width:auto;" /></a></div>
                    <div class="center">
                        <a href="#show_user_image" data-rel="popup" data-position-to="window" data-transition="fade"><img class="popphoto" src="images/profiles/nick.png" alt="profile"></a>
                    </div>
                    <p><span class="user_name">Please setup your account</span></p>
                </div>
            </div>
            <div data-role="popup" id="show_user_image" data-overlay-theme="b" data-theme="b" data-corners="false">
                <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="images/profiles/nick.png" style="max-height:512px;" alt="profile">
            </div>

            <div id="show_user_container">

            </div>
        </div>
        <div data-role="panel" id="show_user_panel" data-position="right" data-display="reveal" data-theme="b" class="ui-panel ui-panel-position-right ui-panel-display-reveal ui-body-b ui-panel-animate ui-panel-open">
            <div class="ui-panel-inner">
                <ul class="friends">
                    <li class="search"><img src="images/search.png" /><input type="text" alt="Search friends" data-role="none" class="search_contact" /><div class="clear-fix"></div></li>
                </ul>
            </div>
        </div>
    </div>

    <div data-role="page" id="edit_user" data-theme="b">
        <div data-role="header" class="header">
            <div class="left"><a href="#share" data-rel="popup" data-transition="fade" data-position-to="origin"><img src="images/share.png" /></a><a data-transition="none" onclick="scan()"><img src="images/scan.png" /></a></div>
            <div class="right"><a href="#edit_user_panel" data-transition="none"><img src="images/friends.png" class="friends" /></a><a href="#menu" data-rel="popup" data-transition="fade"><img src="images/menu.png" /></a></div>
            <div class="center"><a href="#show_user" data-transition="none"><img src="images/logo.png" class="logo" /></a></div>
        </div>

        <div data-role="content" class="ui-content home" role="main">
            <div class="section profile">
                <div class="profile">
                    <div class="center"><img src="images/profiles/nick.png" /></div>
                    <p>Edit your profile</p>
                </div>
            </div>

            <div id="edit_user_container">

            </div>

            <div class="section">
                <a href="#edit_user_field" data-rel="popup" data-transition="none" class="ui-btn" data-position-to="window">Add new field</a>
            </div>

            <div data-role="popup" id="edit_user_field" data-overlay-theme="b" data-theme="b">
                <ul data-role="listview" data-inset="true" style="min-width:210px;">
                    <li data-role="list-divider">Select field</li>
                    <li><a data-rel="back" class="ui-btn field-button" onclick="addField('mail')">Mail</a></li>
                    <li><a data-rel="back" class="ui-btn field-button" onclick="addField('number')">Phone number</a></li>
                    <li><a data-rel="back" class="ui-btn field-button" onclick="addField('social')">Social</a></li>
                    <li><a data-rel="back" class="ui-btn field-button" onclick="addField('gaming')">Gaming</a></li>
                    <li><a data-rel="back" class="ui-btn">Cancel</a></li>
                </ul>
            </div>

            <div data-role="popup" id="edit_user_number" data-overlay-theme="b" data-theme="b">
                <ul data-role="listview" data-inset="true" style="min-width:210px;">
                    <li data-role="list-divider">Phone number</li>
                    <li><img src="images/buttons/privateNumber.png" /><input type="text" alt="Private number" id="privateNumber" /></li>
                    <li><img src="images/buttons/privateNumber.png" /><input type="text" alt="Work number" id="workNumber" /></li>
                    <li><a data-rel="back" class="ui-btn" onclick="saveProfile()">Save</a></li>
                </ul>
            </div>

            <div data-role="popup" id="edit_user_mail" data-overlay-theme="b" data-theme="b">
                <ul data-role="listview" data-inset="true" style="min-width:210px;">
                    <li data-role="list-divider">Mail</li>
                    <li><img src="images/buttons/privateNumber.png" /><input type="text" alt="Private mail" id="privateMail" /></li>
                    <li><img src="images/buttons/privateNumber.png" /><input type="text" alt="Work mail" id="workMail" /></li>
                    <li><a data-rel="back" class="ui-btn" onclick="saveProfile()">Save</a></li>
                </ul>
            </div>

            <div data-role="popup" id="edit_user_social" data-overlay-theme="b" data-theme="b">
                <ul data-role="listview" data-inset="true" style="min-width:210px;">
                    <li data-role="list-divider">Social</li>
                    <li><img src="images/buttons/facebook.png" /><input type="text" alt="Facebook" id="facebook" /></li>
                    <li><img src="images/buttons/twitter.png" /><input type="text" alt="Twitter" id="twitter" /></li>
                    <li><a data-rel="back" class="ui-btn" onclick="saveProfile()">Save</a></li>
                </ul>
            </div>

            <div data-role="popup" id="edit_user_gaming" data-overlay-theme="b" data-theme="b">
                <ul data-role="listview" data-inset="true" style="min-width:210px;">
                    <li data-role="list-divider">Gaming</li>
                    <li><img src="images/buttons/playstation.png" /><input type="text" alt="Playstation" id="playstation" /></li>
                    <li><img src="images/buttons/xbox.png" /><input type="text" alt="Xbox" id="xbox" /></li>
                    <li><a data-rel="back" class="ui-btn" onclick="saveProfile()">Save</a></li>
                </ul>
            </div>
        </div>

        <div data-role="panel" id="edit_user_panel" data-position="right" data-display="reveal" data-theme="b" class="ui-panel ui-panel-position-right ui-panel-display-reveal ui-body-b ui-panel-animate ui-panel-open">
            <div class="ui-panel-inner">
                <ul class="friends">
                    <li class="search"><img src="images/search.png" /><input type="text" alt="Search friends" data-role="none" class="search_contact" /><div class="clear-fix"></div></li>
                </ul>
            </div>
        </div>
    </div>

    <div data-role="page" id="invite_friend" data-theme="b">
        <div data-role="header" class="header">
            <div class="left"><a href="#share" data-rel="popup" data-transition="fade" data-position-to="origin"><img src="images/share.png" /></a><a data-transition="none" onclick="scan()"><img src="images/scan.png" /></a></div>
            <div class="right"><a href="#invite_friend_panel" data-transition="none"><img src="images/friends.png" class="friends" /></a><a href="#menu" data-rel="popup" data-transition="fade"><img src="images/menu.png" /></a></div>
            <div class="center"><a href="#show_user" data-transition="none"><img src="images/logo.png" class="logo" /></a></div>
        </div>

        <div data-role="content" class="ui-content home" role="main">
            <div class="section">
                <div class="profile">
                    <div class="center"><img src="images/profiles/nick.png" /></div>
                    <p><span class="user_name">Please setup your account</span></p>
                </div>
            </div>
            <p class="text_invite_friend">
                Please enter the email address of the Forgather account you would like to share cards with.
                <input type="text" id="invite_email" alt="Email" />
                <input type="button" value="Share cards" onclick="inviteFriend()" />
            </p>
            <p class="disclaimer_invite_friend">
                To finish the card sharing progress the recipient needs to accept your request first.
            </p>
        </div>

        <div data-role="panel" id="invite_friend_panel" data-position="right" data-display="reveal" data-theme="b" class="ui-panel ui-panel-position-right ui-panel-display-reveal ui-body-b ui-panel-animate ui-panel-open">
            <div class="ui-panel-inner">
                <ul class="friends">
                    <li class="search"><img src="images/search.png" /><input type="text" alt="Search friends" data-role="none" class="search_contact" /><div class="clear-fix"></div></li>
                </ul>
            </div>
        </div>
    </div>

    <div data-role="page" id="show_friend" data-theme="b">
        <div data-role="header" class="header">
            <div class="left"><a href="#share" data-rel="popup" data-transition="fade" data-position-to="origin"><img src="images/share.png" /></a><a data-transition="none" onclick="scan()"><img src="images/scan.png" /></a></div>
            <div class="right"><a href="#show_friend_panel" data-transition="none"><img src="images/friends.png" class="friends" /></a><a href="#menu" data-rel="popup" data-transition="fade"><img src="images/menu.png" /></a></div>
            <div class="center"><a href="#show_user" data-transition="none"><img src="images/logo.png" class="logo" /></a></div>
        </div>

        <div data-role="content" class="ui-content home" role="main">
            <div class="section">
                <div class="profile">
                    <div class="right"><a href="#show_user" data-transition="none" onclick="deleteFriend()"><img src="images/delete.png" style="height:30px; width:auto;" /></a></div>
                    <div class="center">
                        <a href="#show_user_image" data-rel="popup" data-position-to="window" data-transition="fade"><img class="popphoto" src="images/profiles/nick.png" alt="profile"></a>
                    </div>
                    <p><span class="friend_name">Friend name</span></p>
                </div>
            </div>
            <div data-role="popup" id="show_friend_image" data-overlay-theme="b" data-theme="b" data-corners="false">
                <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="images/profiles/nick.png" style="max-height:512px;" alt="profile">
            </div>
            <div class="show_friend_invited">
                This person has requested to shair cards with you.

                <input type="button" value="Accept" onclick="acceptFriend(null)" /><input type="button" value="Decline" onclick="declineFriend(null)" />

            </div>

            <div id="show_friend_container">

            </div>
        </div>

        <div data-role="panel" id="show_friend_panel" data-position="right" data-display="reveal" data-theme="b" class="ui-panel ui-panel-position-right ui-panel-display-reveal ui-body-b ui-panel-animate ui-panel-open">
            <div class="ui-panel-inner">
                <ul class="friends">
                    <li class="search"><img src="images/search.png" /><input type="text" alt="Search friends" data-role="none" class="search_contact" /><div class="clear-fix"></div></li>
                </ul>
            </div>
        </div>
    </div>

    <div data-role="page" id="generate_QR" data-theme="b">
        <div data-role="header" class="header">
            <div class="left"><a href="#share" data-rel="popup" data-transition="fade" data-position-to="origin"><img src="images/share.png" /></a><a data-transition="none" onclick="scan()"><img src="images/scan.png" /></a></div>
            <div class="right"><a href="#show_friend_panel" data-transition="none"><img src="images/friends.png" class="friends" /></a><a href="#menu" data-rel="popup" data-transition="fade"><img src="images/menu.png" /></a></div>
            <div class="center"><a href="#show_user" data-transition="none"><img src="images/logo.png" class="logo" /></a></div>
        </div>

        <div data-role="content" class="ui-content home" role="main">
            <div class="section">
                <div class="profile">
                    <div class="right"><a href="#edit_user" data-transition="none"><img src="images/edit.png" style="height:30px; width:auto;" /></a></div>
                    <div class="center">
                        <a href="#generate_QR_profile" data-rel="popup" data-position-to="window" data-transition="fade"><img class="popphoto" src="images/profiles/nick.png" alt="profile"></a>
                    </div>
                    <p><span class="user_name">Please setup your account</span></p>
                </div>
            </div>
            <div data-role="popup" id="generate_QR_profile" data-overlay-theme="b" data-theme="b" data-corners="false">
                <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="images/profiles/nick.png" style="max-height:512px;" alt="profile">
            </div>

            <div class="section">
                <p>With this QR code people can add you to Forgather.</p>
                <input type="button" value="QR" onclick="encode()" />
            </div>
        </div>

        <div data-role="panel" id="show_friend_panel" data-position="right" data-display="reveal" data-theme="b" class="ui-panel ui-panel-position-right ui-panel-display-reveal ui-body-b ui-panel-animate ui-panel-open">
            <div class="ui-panel-inner">
                <ul class="friends">
                    <li class="search"><img src="images/search.png" /><input type="text" alt="Search friends" data-role="none" class="search_contact" /><div class="clear-fix"></div></li>
                </ul>
            </div>
        </div>
    </div>


    <script src="barcodescanner.js"></script>
    <script src="scripts/database-connection.js"></script>
    <script>
        var profile;
        var friends;

        $(document).ready(function () {
            $("#menu").enhanceWithin().popup();
            $("#share").enhanceWithin().popup();
            profile = JSON.parse(window.localStorage.getItem('profile'));

            setInputFields()
            getFriends();
            searchFriends();
        });

        function scan() {
            window.cordova.plugins.barcodeScanner.scan(
                function (result) {
                    alert("We got a barcode\n" +
                          "Result: " + result.text + "\n" +
                          "Format: " + result.format + "\n" +
                          "Cancelled: " + result.cancelled);
                },
                function (error) {
                    alert("Scanning failed: " + error);
                }
            );
        }

        function encode() {
            cordova.plugins.barcodeScanner.encode(BarcodeScanner.Encode.TEXT_TYPE, "http://www.nytimes.com", function (success) {
                    alert("encode success: " + success);
                }, function (fail) {
                    alert("encoding failed: " + fail);
                }
            );
        }

        function feedback() {
            alert("You wish");
        }

        function logout() {
            profile = null;
            friends = [];
            window.location.href = "./index.html#login";
        }

        function setInputFields() {
            $("input:text, input:password").each(function () {
                $(this).val($(this).attr("alt"));
            });

            // clear input.text on focus, if still in default
            $("input:text, input:password").focus(function () {
                if ($(this).val() == $(this).attr("alt")) {
                    $(this).val("");
                }
            });

            // if field is empty afterward, add text again
            $("input:text, input:password").blur(function () {
                if ($(this).val() == "") {
                    $(this).val($(this).attr("alt"));
                }
            });

            if (profile.profileID != 0) {
                setProfileData();
            }
        }

        var categories = [["privateNumber", "number"], ["workNumber", "number"], ["privateMail", "mail"], ["workMail", "mail"], ["facebook", "social"], ["twitter", "social"], ["playstation", "gaming"], ["xbox", "gaming"]];
        var number = false;
        var mail = false;
        var social = false;
        var gaming = false;
        function setProfileData() {
            number = false;
            mail = false;
            social = false;
            gaming = false;
            //home
            $('.user_name').text(profile.name);

            //edit
            //invullen van waarden voor te bewerken

            for (var property in profile) {
                if (profile[property] != null) {
                    $("#" + property).val(profile[property]);
                }
            }

            //opvullen lijst van info
            $("#show_user_container").empty();
            $("#edit_user_container").empty();
            for (var i = 0; i < categories.length; i++) {
                for (var property in profile) {
                    if (profile[property] != null) {
                        if (categories[i][0] == property) {
                            if (!window[categories[i][1]]) {
                                $("#show_user_container").append('<div class="section"><p class="left"><img src="images/buttons/' + categories[i][1] + '.png" /></p><ul class="left" id="show_user_' + categories[i][1] + '_container"></ul><div class="clear-fix"></div></div>');
                                $("#edit_user_container").append('<div class="section"><p class="left"><img src="images/buttons/' + categories[i][1] + '.png" /><br /><a href="#edit_user_' + categories[i][1] + '" data-rel="popup" data-role="none" data-transition="none" data-position-to="window"><img src="images/add.png" /></a></p><ul id="edit_user_' + categories[i][1] + '_container"></ul><div class="clear-fix"></div></div>');
                                window[categories[i][1]] = true;
                            }
                            $('#show_user_' + categories[i][1] + '_container').append('<li><img src="images/buttons/' + property + '.png" class="left"/><span class="left">' + profile[property] + '</span></li>');
                            $('#edit_user_' + categories[i][1] + '_container').append('<li><img src="images/buttons/' + property + '.png" class="left"/><span class="left">' + profile[property] + '</span><img src="images/delete.png" class="right" onclick="deleteProperty(' + i + ')"/></li>');
                        }
                    }
                }
            }
        }

        function addField(section) {
            if ($("#edit_user_" + section + '_container').length == 0) {
                $("#edit_user_container").append('<div class="section"><p class="left"><img src="images/buttons/' + section + '.png" /><br /><a href="#edit_user_' + section + '" data-rel="popup" data-role="none" data-transition="none" data-position-to="window"><img src="images/add.png" /></p><ul class="left" id="edit_user_' + section + '_container"></ul><div class="clear-fix"></div></div>');
            }
        }

        function deleteProperty(number) {
            profile[categories[number][0]] = null;

            $.ajax({
                url: url + 'api/profile/postprofile',
                type: 'POST',
                async: false,
                contentType: 'application/json',
                data: JSON.stringify(profile),
                success: function (data) {
                    profile = data;
                    window.localStorage.setItem('profile', JSON.stringify(data));
                    setInputFields();
                },
                error: function (e) {
                    alert("Something went wrong.");
                },
                dataType: 'json',
                contentType: "application/json"
            });
        }

        function saveProfile() {
            for (var property in profile) {
                element = $("#" + property);
                if (element.val() != element.attr("alt")) {
                    profile[property] = element.val();
                }
            }

            $.ajax({
                url: url + 'api/profile/postprofile',
                type: 'POST',
                async: false,
                contentType: 'application/json',
                data: JSON.stringify(profile),
                success: function (data) {
                    profile = data;
                    window.localStorage.setItem('profile', JSON.stringify(data));
                    setProfileData();
                },
                error: function (e) {
                    alert("Something went wrong.");
                },
                dataType: 'json',
                contentType: "application/json"
            });
        }
    </script>
    <script src="scripts/friend.js"></script>
</body>

</html>
